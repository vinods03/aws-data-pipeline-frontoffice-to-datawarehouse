import json
import boto3

s3 = boto3.client('s3')
source_bucket = 'vinod-streaming-project-bucket'

def lambda_handler(event, context):
    
    files_to_be_deleted = []
    print('The event is ', event)
    
    for record in event['Records']:
        
        print('The record is ', record)
        print('record dynamodb Keys is ', record['dynamodb']['Keys'])
        print('record dynamodb Keys file_name is ', record['dynamodb']['Keys']['file_name'])
        print('record dynamodb Keys file_name S is ', record['dynamodb']['Keys']['file_name']['S'])
        files_to_be_deleted.append(record['dynamodb']['Keys']['file_name']['S'])
            
    print('The files to be deleted are: ', files_to_be_deleted)
    
    for file in files_to_be_deleted:
        
        try: 
                        
            s3_delete_response = s3.delete_object(Bucket = source_bucket, Key = file)
            print('The s3 delete response is ', s3_delete_response)
            print(file, ' deleted successfully')
            
        except Exception as f:
                        
                print('Unable to delete file in landing area. The exception is ', f)
    
                
       
            